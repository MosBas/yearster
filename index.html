<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yearster - ××©×—×§ × ×™×—×•×© ×©× ×ª ×©×™×¨×™×</title>
  <meta name="description" content="Yearster - ×”××–×™× ×• ×œ×©×™×¨ ×•× ×—×©×• ×‘××™×–×• ×©× ×” ×”×•× ×™×¦×!">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;600;700;900&family=Inter:wght@300;400;600;700;900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="bg-effects">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
  </div>

  <!-- ===== INSTRUCTIONS MODAL ===== -->
  <div id="instructions-modal" class="modal-overlay" style="display:none;" onclick="closeInstructions(event)">
    <div class="modal-content glass" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeInstructions()">&times;</button>
      <h2 class="modal-title">ğŸ“– ××™×š ××©×—×§×™×?</h2>
      <div class="instructions-body">
        <div class="instruction-item">
          <span class="instruction-icon">ğŸ‘¥</span>
          <div>
            <strong>×©×—×§× ×™×</strong>
            <p>2-5 ×©×—×§× ×™×. ×”×›× ×™×¡×• ×©××•×ª ×•×œ×—×¦×• ×”×ª×—×œ.</p>
          </div>
        </div>
        <div class="instruction-item">
          <span class="instruction-icon">ğŸµ</span>
          <div>
            <strong>×”××–× ×”</strong>
            <p>×‘×›×œ ×ª×•×¨ ××•×©××¢ ×©×™×¨ ×‘×××¦×¢×•×ª Spotify. ×©× ×”×©×™×¨ ××•×¡×ª×¨!</p>
          </div>
        </div>
        <div class="instruction-item">
          <span class="instruction-icon">ğŸ“…</span>
          <div>
            <strong>× ×™×—×•×©</strong>
            <p>×‘×—×¨×• ××ª ×”×©× ×” ×©×‘×” ×œ×“×¢×ª×›× ×™×¦× ×”×©×™×¨ (1970-2025).</p>
          </div>
        </div>
        <div class="instruction-item">
          <span class="instruction-icon">ğŸ“Š</span>
          <div>
            <strong>× ×™×§×•×“</strong>
            <p>× ×™×§×•×“ = 100 ×¤×—×•×ª ×”××¨×—×§ ×‘×©× ×™×. ×›×›×œ ×©×§×¨×•×‘ ×™×•×ª×¨ â€” ×™×•×ª×¨ × ×§×•×“×•×ª!</p>
          </div>
        </div>
        <div class="instruction-item">
          <span class="instruction-icon">ğŸ¯</span>
          <div>
            <strong>×¤×’×™×¢×” ××“×•×™×§×ª</strong>
            <p>× ×™×—×•×© ××“×•×™×§ ×©×œ ×”×©× ×” = <strong>×‘×•× ×•×¡ 110 × ×§×•×“×•×ª!</strong></p>
          </div>
        </div>
        <div class="instruction-item">
          <span class="instruction-icon">ğŸ†</span>
          <div>
            <strong>× ×™×¦×—×•×Ÿ</strong>
            <p>××—×¨×™ 10 ×¡×™×‘×•×‘×™×, ××™ ×©×¦×‘×¨ <strong>×”×›×™ ×”×¨×‘×”</strong> × ×§×•×“×•×ª â€” ×× ×¦×—!</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== JOIN GAME MODAL ===== -->
  <div id="join-modal" class="modal-overlay" style="display:none;" onclick="closeJoinModal(event)">
    <div class="modal-content glass" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeJoinModal()">&times;</button>
      <h2 class="modal-title">ğŸ”— ×”×¦×˜×¨×¤×•×ª ×œ××©×—×§</h2>
      <div class="join-body">
        <p>×”×›× ×¡ ××ª ×§×•×“ ×”××©×—×§ ×©×§×™×‘×œ×ª ××”×××¨×—:</p>
        <input type="text" id="join-code-input" class="player-input" placeholder="ABCD" maxlength="4" style="text-align: center; font-size: 2rem; text-transform: uppercase;">
        <button id="btn-confirm-join" class="btn btn-primary btn-large" style="margin-top: 20px;" onclick="joinOnlineGame()">
          <span class="btn-text">ğŸš€ ×”×¦×˜×¨×£!</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ===== SCREEN 1: REGISTRATION ===== -->
  <div id="screen-register" class="screen active">
    <div class="container">
      <div class="logo-section">
        <h1 class="logo">
          <span class="logo-icon">ğŸµ</span>
          <span class="logo-text">YEARSTER</span>
        </h1>
        <p class="tagline">× ×—×©×• ××ª ×”×©× ×”. × ×¦×—×• ××ª ×”×—×‘×¨×™×.</p>
      </div>

      <div class="card glass">
        <h2 class="card-title">×©××•×ª ×”×©×—×§× ×™× (××©×—×§ ××§×•××™)</h2>
        <div class="players-form">
          <div class="player-input-row">
            <span class="player-number">1</span>
            <input type="text" id="player-1" class="player-input" placeholder="×©×—×§×Ÿ 1" maxlength="15"
              autocomplete="off">
          </div>
          <div class="player-input-row">
            <span class="player-number">2</span>
            <input type="text" id="player-2" class="player-input" placeholder="×©×—×§×Ÿ 2" maxlength="15"
              autocomplete="off">
          </div>
          <div class="player-input-row">
            <span class="player-number">3</span>
            <input type="text" id="player-3" class="player-input" placeholder="×©×—×§×Ÿ 3 (××•×¤×¦×™×•× ×œ×™)" maxlength="15"
              autocomplete="off">
          </div>
          <div class="player-input-row">
            <span class="player-number">4</span>
            <input type="text" id="player-4" class="player-input" placeholder="×©×—×§×Ÿ 4 (××•×¤×¦×™×•× ×œ×™)" maxlength="15"
              autocomplete="off">
          </div>
          <div class="player-input-row">
            <span class="player-number">5</span>
            <input type="text" id="player-5" class="player-input" placeholder="×©×—×§×Ÿ 5 (××•×¤×¦×™×•× ×œ×™)" maxlength="15"
              autocomplete="off">
          </div>
        </div>
        <button id="btn-start" class="btn btn-primary btn-large" onclick="startGame()">
          <span class="btn-text">ğŸ¶ ×”×ª×—×™×œ×• ×œ×©×—×§ ××§×•××™!</span>
        </button>
        
        <div class="divider"><span>××•</span></div>
        
        <div class="online-actions">
           <button class="btn btn-accent btn-large" onclick="createOnlineGame()">
            <span class="btn-text">ğŸŒ ×¦×•×¨ ××©×—×§ ××•× ×œ×™×™×Ÿ</span>
          </button>
          <button class="btn btn-secondary btn-large" onclick="openJoinModal()" style="margin-top: 10px;">
            <span class="btn-text">ğŸ”— ×”×¦×˜×¨×£ ×œ××©×—×§ ×§×™×™×</span>
          </button>
        </div>

        <button class="btn btn-secondary" onclick="openInstructions()" style="margin-top: 24px; width: 100%;">
          <span class="btn-text">ğŸ“– ××™×š ××©×—×§×™×?</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ===== SCREEN 1.5: LOBBY ===== -->
  <div id="screen-lobby" class="screen">
    <div class="container">
      <div class="card glass">
        <h2 class="card-title">×œ×•×‘×™ ××©×—×§</h2>
        <div class="game-code-box">
          <span class="code-label">×§×•×“ ×”××©×—×§:</span>
          <span id="lobby-game-code" class="code-value">----</span>
        </div>
        <div id="lobby-players-list" class="lobby-players-list">
          <!-- Players will be listed here -->
        </div>
        <p id="lobby-status-msg" class="lobby-status">×××ª×™× ×™× ×œ×©×—×§× ×™×...</p>
        <button id="btn-lobby-start" class="btn btn-primary btn-large" onclick="startOnlineGame()" style="display: none;">
          <span class="btn-text">ğŸš€ ×›×•×œ× ×›××Ÿ? ×‘×•××• × ×ª×—×™×œ!</span>
        </button>
        <button class="btn btn-secondary btn-large" onclick="leaveLobby()" style="margin-top: 12px;">
          <span class="btn-text">ğŸšª ×¦× ××”×—×“×¨</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ===== SCREEN 2: GAME ===== -->
  <div id="screen-game" class="screen">
    <div class="container">
      <!-- Top bar: round & scores -->
      <div class="game-top-bar">
        <div id="online-game-indicator" class="online-indicator glass-sm" style="display: none;">
          ğŸŒ <span id="active-game-code"></span>
        </div>
        <div class="round-info glass-sm">
          <span class="round-label">×¡×™×‘×•×‘</span>
          <span id="round-number" class="round-num">1</span>
          <span class="round-of">××ª×•×š 10</span>
        </div>
        <div id="scoreboard-mini" class="scoreboard-mini"></div>
        <button class="btn-abandon glass-sm" onclick="abandonGame()" title="×™×¦×™××” ××”××©×—×§">ğŸšª</button>
      </div>

      <!-- Current player banner -->
      <div id="current-player-banner" class="current-player-banner glass">
        <div class="player-avatar" id="player-avatar">ğŸ¤</div>
        <div class="player-turn-info">
          <span class="turn-label">×”×ª×•×¨ ×©×œ</span>
          <span id="current-player-name" class="turn-name">×©×—×§×Ÿ</span>
        </div>
      </div>

      <!-- Spotify Player -->
      <div class="spotify-container glass">
        <div id="spotify-embed" class="spotify-embed">
          <!-- iframe will be injected here -->
        </div>
        <div id="song-cover" class="song-cover">
          <div class="song-cover-text">ğŸµ ××” ×”×©×™×¨?</div>
        </div>
      </div>

      <!-- Year Guess Section -->
      <div id="guess-section" class="guess-section glass">
        <label class="guess-label">×‘××™×–×• ×©× ×” ×™×¦× ×”×©×™×¨?</label>

        <!-- Decade quick-select buttons -->
        <div class="decade-buttons">
          <button class="decade-btn" onclick="setDecade(1970)">70s</button>
          <button class="decade-btn" onclick="setDecade(1980)">80s</button>
          <button class="decade-btn" onclick="setDecade(1990)">90s</button>
          <button class="decade-btn" onclick="setDecade(2000)">00s</button>
          <button class="decade-btn" onclick="setDecade(2010)">10s</button>
          <button class="decade-btn" onclick="setDecade(2020)">20s</button>
        </div>

        <!-- Year fine-tuning -->
        <div class="year-picker">
          <button class="year-btn year-btn-large" onclick="adjustYear(-5)">-5</button>
          <button class="year-btn" onclick="adjustYear(-1)">-1</button>
          <div class="year-display-container">
            <span id="year-display" class="year-display">2000</span>
          </div>
          <button class="year-btn" onclick="adjustYear(1)">+1</button>
          <button class="year-btn year-btn-large" onclick="adjustYear(5)">+5</button>
        </div>

        <input type="hidden" id="year-value" value="2000">

        <button id="btn-guess" class="btn btn-primary" onclick="submitGuess()">
          <span class="btn-text">ğŸ¯ × ×—×©!</span>
        </button>
      </div>

      <!-- Result Section (hidden until guess) -->
      <div id="result-section" class="result-section glass" style="display:none;">
        <div id="result-emoji" class="result-emoji">ğŸ¯</div>
        <div id="result-text" class="result-text"></div>
        <div class="result-details">
          <div class="result-row">
            <span class="result-label">× ×™×—×©×ª:</span>
            <span id="result-guessed" class="result-value"></span>
          </div>
          <div class="result-row">
            <span class="result-label">×”×©× ×” ×”×××™×ª×™×ª:</span>
            <span id="result-actual" class="result-value highlight"></span>
          </div>
          <div class="result-row">
            <span class="result-label">×©× ×”×©×™×¨:</span>
            <span id="result-song" class="result-value"></span>
          </div>
          <div class="result-row score-row">
            <span class="result-label">× ×§×•×“×•×ª:</span>
            <span id="result-points" class="result-value points"></span>
          </div>
        </div>
        <button id="btn-next" class="btn btn-secondary" onclick="nextTurn()">
          <span class="btn-text">â­ï¸ ×”×‘×</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ===== SCREEN 3: RESULTS ===== -->
  <div id="screen-results" class="screen">
    <div class="container">
      <div class="results-header">
        <div class="trophy">ğŸ†</div>
        <h1 class="results-title">×¡×™×•× ×”××©×—×§!</h1>
      </div>

      <div id="winner-card" class="winner-card glass">
        <div class="winner-crown">ğŸ‘‘</div>
        <div class="winner-label">×”×× ×¦×—</div>
        <div id="winner-name" class="winner-name"></div>
        <div id="winner-score" class="winner-score"></div>
      </div>

      <div class="final-scores glass">
        <h2 class="scores-title">×˜×‘×œ×ª × ×™×§×•×“</h2>
        <div id="final-scoreboard" class="final-scoreboard"></div>
      </div>

      <button class="btn btn-primary btn-large" onclick="resetGame()">
        <span class="btn-text">ğŸ”„ ××©×—×§ ×—×“×©</span>
      </button>
    </div>
  </div>

  <script src="songs.js"></script>
  
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, update, get, child, onDisconnect } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    async function init() {
      try {
        // Fetch config automatically from Firebase Hosting reserved URL
        const response = await fetch('/__/firebase/init.json');
        const firebaseConfig = await response.json();

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Expose needed Firebase functions to window so game.js can use them
        window.fb = {
          db, ref, set, onValue, push, update, get, child, onDisconnect
        };
        
        console.log("Firebase initialized automatically");
      } catch (e) {
        console.error("Firebase initialization failed. If running locally, you might need to hardcode the config or use firebase serve.", e);
      }
    }
    
    init();
  </script>

  <script src="game.js"></script>
</body>

</html>